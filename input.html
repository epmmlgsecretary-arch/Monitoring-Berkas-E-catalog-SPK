<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ADMIN - FARMA</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: #dff1d8;
  color: #333;
}

/* ===== LOGOUT ===== */
.logout-btn {
  position: fixed;
  top: 26px;
  right: 32px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 50;
}
.logout-btn svg {
  width: 30px;
  height: 30px;
  stroke: #d32f2f;
}
.logout-btn:hover svg {
  stroke: #b71c1c;
}

/* ===== HERO + WAVE ===== */
.hero {
  position: relative;
  padding: 110px 40px 180px;
  overflow: hidden;
}

.wave-top {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 220px;
}

.hero-inner {
  max-width: 1300px;
  margin: auto;
}

.hero h1 {
  margin: 0;
  font-size: 56px;
  font-weight: 900;
  color: #7cb342;
}

/* ===== FORM AREA ===== */
.admin-page {
  position: relative;
  margin-top: -160px;
  padding: 0 40px;
}

.form-container {
  max-width: 1300px;
  margin: auto;
}

.card {
  background: transparent;
  padding: 30px 10px 10px;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 26px 40px;
}

.form-field {
  max-width: 520px;
}

label {
  font-size: 13px;
  font-weight: 600;
}

.required {
  color: #d32f2f;
  font-weight: 700;
}

input {
  width: 100%;
  padding: 12px 18px;
  border-radius: 999px;
  border: 1.5px solid rgba(0,0,0,0.6);
  background: #d9f0d5;
  outline: none;
}

input:focus {
  border-color: #7cb342;
}

/* ===== SUBMIT + DIVIDER ===== */
.submit-wrap {
  position: relative;
  display: flex;
  justify-content: flex-end;
  margin-top: 36px;
  padding-bottom: 36px;
}

.submit-wrap::after {
  content: "";
  position: absolute;
  left: -40px;
  right: -40px;
  bottom: 0;
  height: 2px;
  background: rgba(0,0,0,0.35);
}

.submit-wrap button {
  background: #1e5aa7;
  color: #fff;
  padding: 14px 30px;
  border-radius: 999px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

/* ===== HISTORY ===== */
.history {
  padding: 20px 40px 80px;
}

.history-title {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 20px;
  font-weight: 800;
  color: #000;
  margin: 18px 0;
}

.history-title::before {
  content: "";
  width: 34px;
  height: 34px;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2.5' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3 12a9 9 0 1 0 3-6.7'/%3E%3Cpath d='M3 4v5h5'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center;
  flex-shrink: 0;
}

/* ===== SEARCH ===== */
.search-wrapper {
  position: relative;
  z-index: 5;
  display: flex;
  justify-content: center;
  margin-top: -28px;
  margin-bottom: 24px;
}

.search-box {
  position: relative;
  width: 520px;
  max-width: 90%;
}

.search-icon {
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

.search-box input {
  width: 100%;
  padding: 12px 18px 12px 46px;
  border-radius: 999px;
  border: 1.5px solid rgba(0,0,0,0.6);
  background: #dff1d8;
  outline: none;
  font-size: 14px;
}

/* ===== TABLE ===== */
/* ===== TABLE ===== */
.table-container {
  width: 100%;                /* üî• full */
  max-width: 1600px;          /* üî• lebih lebar dari 1300 */
  margin: auto;
  background: #fff;
  padding: 18px 22px;
  border-radius: 18px;
  box-shadow: 0 14px 34px rgba(0,0,0,0.12);
}

/* ‚ùå matikan scroll kanan-kiri */
.table-wrapper {
  overflow-x: hidden;         /* üî• penting */
}

/* tabel utama */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-size: 13px;
  table-layout: fixed;        /* üî• kunci kolom */
}

/* header */
thead th {
  background: #f6f6f6;
  font-weight: 700;
  text-align: left;
  padding: 12px 14px;
  border-bottom: 2px solid #e0e0e0;
  white-space: nowrap;
}

/* isi */
tbody td {
  padding: 12px 14px;
  border-bottom: 1px solid #eee;
  vertical-align: middle;
  white-space: nowrap;        /* üî• 1 baris */
  overflow: hidden;
  text-overflow: ellipsis;
}

/* hover rapi */
tbody tr:hover {
  background: #f9fafb;
}

/* ===== ALIGNMENT KHUSUS ===== */
th:nth-child(1),
td:nth-child(1) {
  width: 48px;
  text-align: center;
}

th:last-child,
td:last-child {
  width: 90px;
  text-align: center;
}

/* ===== ATUR LEBAR KOLOM (BIAR FULL & RAPI) ===== */
th:nth-child(2),
td:nth-child(2) { width: 260px; } /* Nama Outlet */

th:nth-child(3),
td:nth-child(3) { width: 110px; } /* Online */

th:nth-child(4),
td:nth-child(4) { width: 110px; } /* No SPK */

th:nth-child(5),
td:nth-child(5) { width: 260px; } /* No ID Paket */

th:nth-child(6),
td:nth-child(6) { width: 110px; } /* Nominal */

th:nth-child(7),
td:nth-child(7) { width: 130px; } /* No Faktur */

th:nth-child(8),
td:nth-child(8) { width: 180px; } /* PIC */

th:nth-child(9),
td:nth-child(9) { width: 110px; } /* Status */

th:nth-child(10),
td:nth-child(10){ width: 130px; } /* Lokatore */

/* ===== ICON HEADER ===== */
.th-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  margin-right: 6px;
}

.th-icon svg {
  width: 14px;
  height: 14px;
  stroke: #000;
  fill: none;
  stroke-width: 2;
}



/* ===== BUTTON ===== */
.actions button {
  padding: 6px 16px;
  background: #174ea6;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
}

.actions button:hover {
  background: #123c80;
}


/* ===== BUTTON ===== */
.actions button {
  padding: 6px 16px;
  background: #174ea6;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
}

.actions button:hover {
  background: #123c80;
}


/* ===== ACTION BUTTON ===== */
.actions button {
  padding: 6px 14px;
  background: #1e4fa1;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
}

.actions button:hover {
  background: #163c7a;
}

/* ===== WAVE BOTTOM ===== */
.wave-bottom {
  width: 100%;
  height: 200px;
}
</style>


<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>

<!-- LOGOUT -->
<button class="logout-btn" onclick="keluar()">
  <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
    <polyline points="16 17 21 12 16 7"/>
    <line x1="21" y1="12" x2="9" y2="12"/>
  </svg>
</button>

<!-- HERO -->
<section class="hero">
  <svg class="wave-top" viewBox="0 0 1440 220" preserveAspectRatio="none">
    <path fill="#ffffff"
      d="M0,120 C240,60 480,20 720,40
         C960,60 1200,120 1440,90
         L1440,0 L0,0 Z"/>
  </svg>

  <div class="hero-inner">
    <h1>ADMIN</h1>
  </div>
</section>

<!-- FORM -->
<section class="admin-page">
<div class="form-container">
<div class="card">

<input type="hidden" id="edit_row">

<div class="form-grid">
  <div class="form-field">
    <label>Nama Outlet<span class="required">*</span></label>
    <input id="nama_outlet">
  </div>
  <div class="form-field">
    <label>No ID Paket<span class="required">*</span></label>
    <input id="no_id_paket">
  </div>
  <div class="form-field">
    <label>Status<span class="required">*</span></label>
    <input id="online">
  </div>
  <div class="form-field">
    <label>Nominal<span class="required">*</span></label>
    <input id="nominal">
  </div>
  <div class="form-field">
    <label>No SPK<span class="required">*</span></label>
    <input id="no_spk">
  </div>
  <div class="form-field">
    <label>No Faktur<span class="required">*</span></label>
    <input id="no_faktur">
  </div>
  <div class="form-field">
    <label>PIC Salesmen<span class="required">*</span></label>
    <input id="pic_salesman">
  </div>
</div>

<div class="submit-wrap">
  <button onclick="simpan()">Submit or Update</button>
</div>

</div>
</div>
</section>

<!-- HISTORY -->
<section class="history">
<h3 class="history-title">History</h3>

<div class="search-wrapper">
  <div class="search-box">
    <span class="search-icon">
      <svg
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
        <line
          x1="16.65"
          y1="16.65"
          x2="21"
          y2="21"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>
    </span>

    <input
      id="searchInput"
      placeholder="Search"
      onkeyup="filterTable()"
    />
  </div>
</div>


<div class="table-container">
<div class="table-wrapper">
<table>
<thead>
  <tr>
    <th>No</th>

    <th>
      <span class="th-icon">
        <!-- user -->
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c2-4 14-4 16 0"/>
        </svg>
      </span>
      Nama Outlet
    </th>

    <th>
      <span class="th-icon">
        <!-- list -->
        <svg viewBox="0 0 24 24">
          <line x1="8" y1="6" x2="21" y2="6"/>
          <line x1="8" y1="12" x2="21" y2="12"/>
          <line x1="8" y1="18" x2="21" y2="18"/>
          <circle cx="4" cy="6" r="1"/>
          <circle cx="4" cy="12" r="1"/>
          <circle cx="4" cy="18" r="1"/>
        </svg>
      </span>
      Online
    </th>

    <th>
      <span class="th-icon">#</span>
      No SPK
    </th>

    <th>
      <span class="th-icon">#</span>
      No ID Paket
    </th>

    <th>
      <span class="th-icon">#</span>
      Nominal
    </th>

    <th>
      <span class="th-icon">#</span>
      No Faktur
    </th>

    <th>
      <span class="th-icon">
        <!-- user -->
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c2-4 14-4 16 0"/>
        </svg>
      </span>
      PIC
    </th>

    <th>
      <span class="th-icon">
        <!-- info -->
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="9"/>
          <line x1="12" y1="10" x2="12" y2="16"/>
          <circle cx="12" cy="7" r="1"/>
        </svg>
      </span>
      Status
    </th>
    <th>
      <span class="th-icon">
        <!-- info -->
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="9"/>
          <line x1="12" y1="10" x2="12" y2="16"/>
          <circle cx="12" cy="7" r="1"/>
        </svg>
      </span>
      Lokatore
    </th>

    <th>
      <span class="th-icon">
        <!-- edit -->
        <svg viewBox="0 0 24 24">
          <path d="M4 20h4l10-10-4-4L4 16v4z"/>
        </svg>
      </span>
      Aksi
    </th>
  </tr>
</thead>

<tbody id="tbody"></tbody>
</table>
</div>
</div>
</section>

<!-- WAVE BOTTOM -->
<svg class="wave-bottom" viewBox="0 0 1440 200" preserveAspectRatio="none">
  <path fill="#dff1d8"
    d="M0,60 C240,120 480,140 720,120
       C960,100 1200,40 1440,80
       L1440,200 L0,200 Z"/>
</svg>

<!-- ===== JS ASLI (TIDAK DIUBAH) ===== -->
<script>
const ROLE = sessionStorage.getItem("role") || localStorage.getItem("role");

// ‚ùó jangan redirect, hanya peringatan
if (!ROLE) {
  console.warn("Role tidak ditemukan, history tetap dimuat");
}
</script>


<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxUCbDqE4KZdGJjcznqtsvSOGBOvQi6AeUvybNM3gyOoJCIx0n1XGVtYd0pp2mtHT8h/exec";

const PIN = sessionStorage.getItem("role") === "farma"
  ? sessionStorage.getItem("farma_pin")
  : null;

function keluar() {
  sessionStorage.clear();
  window.location.replace("pin-farma.html");
}

/* ===== LOGIKA ASLI ===== */
function loadData() {
  fetch(API_URL + "?action=farma_list&pin=" + PIN)
    .then(r => r.json())
    .then(data => {

      if (data.error) {
        alert(data.error);
        return;
      }

      tbody.innerHTML = "";
      data.forEach(d => {
        tbody.innerHTML += `
        <tr>
          <td>${d["No"]}</td>
          <td>${d["Nama Outlet"]}</td>
          <td>${d["Online / Tidak"]}</td>
          <td>${d["No SPK"]}</td>
          <td>${d["No ID Paket"]}</td>
          <td>${d["Nominal"]}</td>
          <td>${d["No Faktur"]}</td>
          <td>${d["PIC Salesman"]}</td>
          <td>${d["Keterangan"]}</td>
          <td>${d["Locatore"]}</td>
          <td class="actions">
            <button onclick='editData(${JSON.stringify(d)})'>Edit</button>
          </td>
        </tr>`;
      });
    });
}

function filterTable() {
  const q = searchInput.value.toLowerCase();
  document.querySelectorAll("#tbody tr").forEach(tr => {
    tr.style.display = tr.innerText.toLowerCase().includes(q) ? "" : "none";
  });
}

function editData(d) {
  edit_row.value = d._row;

  nama_outlet.value  = d["Nama Outlet"] || "";
  online.value       = d["Online / Tidak"] || "";
  no_spk.value       = d["No SPK"] || "";
  no_id_paket.value  = d["No ID Paket"] || "";
  nominal.value      = d["Nominal"] || "";
  no_faktur.value    = d["No Faktur"] || "";
  pic_salesman.value = d["PIC Salesman"] || "";

  window.scrollTo({ top: 0, behavior: "smooth" });
}


    function simpan() {
    if (edit_row.value) {
      fetch(API_URL + "?" + new URLSearchParams({
        action: "farma_update",
        pin: sessionStorage.getItem("farma_pin"), // üî• WAJIB
        row: edit_row.value,
        nama_outlet: nama_outlet.value,
        online: online.value,
        no_spk: no_spk.value,
        no_id_paket: no_id_paket.value,
        nominal: nominal.value,
        no_faktur: no_faktur.value,
        pic_salesman: pic_salesman.value
      }))
      .then(r => r.json())
      .then(res => {
        if (res.error) {
          swal("Gagal", res.error, "error");
          return;
        }
        swal("Berhasil", "Data FARMA diperbarui", "success");
        resetForm();
        loadData();
      });
    }


  // ===== UPDATE =====
  if (ROLE === "farma") {
    // üîµ UPDATE FARMA
    fetch(API_URL + "?" + new URLSearchParams({
      action: "farma_update",
      row: edit_row.value,
      nama_outlet: nama_outlet.value,
      online: online.value,
      no_spk: no_spk.value,
      no_id_paket: no_id_paket.value,
      nominal: nominal.value,
      no_faktur: no_faktur.value,
      pic_salesman: pic_salesman.value
    }))
    .then(() => {
      swal("Berhasil", "Data FARMA diperbarui", "success");
      resetForm();
      loadData();
    });

  } else if (ROLE === "admin") {
    // üî¥ UPDATE ADMIN
    fetch(API_URL + "?" + new URLSearchParams({
      action: "admin_update",
      row: edit_row.value,
      keterangan: keterangan.value,
      locatore: locatore.value
    }))
    .then(() => {
      swal("Berhasil", "Data ADMIN diperbarui", "success");
      resetForm();
      loadData();
    });
  }
}

function resetForm() {
  edit_row.value = "";
  document.querySelectorAll("input").forEach(i => i.value = "");
}

loadData();
</script>
</body>
</html>



